echo Begin of Upgrade 7.0.4
DBI <<\EOF
CREATE TABLE ZSFDC_TEST 'SFDC Test' 1
ID (INT,13,'Test ID')
USER (INT,13,'User ID')
CDATE (DATE,8,'Date Opened')
UNIQUE (ID)
;
CREATE TABLE ZSFDC_CLEANTABLE 'SFDC Load Clean Up' 1
LOADID (INT,17,'Load ID')
LINE (INT,17,'Ln')
UNIQUE (LOADID,LINE)
;
EOF
BRING << \EOF
17 10 ZSFDC_TEST31 Test Priority Mobile Connection0 80 0 0 0 0 4 SFDC0 0 
57 20 Internal Development1 
58 1 10 ZSFDC_TEST80 
7 10 ZSFDC_TEST80 10 4 SQLI67 
28 10 ZSFDC_TEST80 10 9 :NEXT =0;1 1 
28 10 ZSFDC_TEST80 10 46 SELECT MAX(ID) + 1 INTO :NEXT FROM ZSFDC_TEST;2 2 
28 10 ZSFDC_TEST80 10 22 INSERT INTO ZSFDC_TEST3 3 
28 10 ZSFDC_TEST80 10 17 (ID, USER, CDATE)4 4 
28 10 ZSFDC_TEST80 10 6 VALUES5 5 
28 10 ZSFDC_TEST80 10 29 (:NEXT, SQL.USER, SQL.DATE );6 6 
7 10 ZSFDC_TEST80 20 3 END66 
7 10 ZSFDC_TEST80 30 4 SQLI67 
28 10 ZSFDC_TEST80 30 33 :ID = :LINE = :NOLD = :FIRST = 0;1 1 
28 10 ZSFDC_TEST80 30 19 :LOADED = :RT = '';2 2 
28 10 ZSFDC_TEST80 30 32 /* ITERATE THROUGH LOAD TABLE */3 3 
28 10 ZSFDC_TEST80 30 22 DECLARE Cur CURSOR FOR4 4 
28 10 ZSFDC_TEST80 30 36 SELECT RECORDTYPE, LINE, LOADED FROM5 5 
28 10 ZSFDC_TEST80 30 41 /********************** LOAD TABLE NAME*/6 6 
28 10 ZSFDC_TEST80 30 11 GENERALLOAD7 7 
28 10 ZSFDC_TEST80 30 41 /***************************************/8 8 
28 10 ZSFDC_TEST80 30 15 WHERE LINE > 0;9 9 
28 10 ZSFDC_TEST80 30 9 OPEN Cur;10 10 
28 10 ZSFDC_TEST80 30 9 LABEL 10;11 11 
28 10 ZSFDC_TEST80 30 35 FETCH Cur INTO :RT, :LINE, :LOADED;12 12 
28 10 ZSFDC_TEST80 30 26 GOTO 20 WHERE :RETVAL = 0;13 13 
28 10 ZSFDC_TEST80 30 52 SELECT 1 INTO :NOLD FROM DUMMY WHERE :LOADED <> 'Y';14 14 
28 10 ZSFDC_TEST80 30 39 GOTO 15 WHERE :RT <> '1' OR :FIRST = 0;15 15 
28 10 ZSFDC_TEST80 30 19 /* RECORD TYPE 1 */16 16 
28 10 ZSFDC_TEST80 30 12 /* LOADED */17 17 
28 10 ZSFDC_TEST80 30 46 GOSUB 300; /* DELETE LOADED FROM LOAD TABLE */18 18 
28 10 ZSFDC_TEST80 30 36 GOSUB 200; /* CLEAN UP LOADING ID */19 19 
28 10 ZSFDC_TEST80 30 33 GOSUB 100; /* GET A LOADING ID */20 20 
28 10 ZSFDC_TEST80 30 9 LABEL 15;21 21 
28 10 ZSFDC_TEST80 30 63 INSERT INTO ZSFDC_CLEANTABLE (LOADID,LINE) VALUES (:ID, :LINE);22 22 
28 10 ZSFDC_TEST80 30 32 SELECT 1 INTO :FIRST FROM DUMMY;23 23 
28 10 ZSFDC_TEST80 30 8 LOOP 10;24 24 
28 10 ZSFDC_TEST80 30 9 LABEL 20;25 25 
28 10 ZSFDC_TEST80 30 10 CLOSE Cur;26 26 
28 10 ZSFDC_TEST80 30 46 GOSUB 300; /* DELETE LOADED FROM LOAD TABLE */27 27 
28 10 ZSFDC_TEST80 30 36 GOSUB 200; /* CLEAN UP LOADING ID */28 28 
28 10 ZSFDC_TEST80 30 25 /************************29 29 
28 10 ZSFDC_TEST80 30 25 ************************/30 30 
28 10 ZSFDC_TEST80 30 8 SUB 100;31 31 
28 10 ZSFDC_TEST80 30 22 /* GET A LOADING ID */32 32 
28 10 ZSFDC_TEST80 30 58 SELECT 0 + MAX(LOADID) + 1 INTO :ID FROM ZSFDC_CLEANTABLE;33 33 
28 10 ZSFDC_TEST80 30 60 INSERT INTO ZSFDC_CLEANTABLE (LOADID, LINE) VALUES (:ID, 0);34 34 
28 10 ZSFDC_TEST80 30 7 RETURN;35 35 
28 10 ZSFDC_TEST80 30 4 /**/36 36 
28 10 ZSFDC_TEST80 30 8 SUB 200;37 37 
28 10 ZSFDC_TEST80 30 25 /* CLEAN UP LOADING ID */38 38 
28 10 ZSFDC_TEST80 30 31 SELECT 0 INTO :NOLD FROM DUMMY;39 39 
28 10 ZSFDC_TEST80 30 48 DELETE FROM ZSFDC_CLEANTABLE WHERE LOADID = :ID;40 40 
28 10 ZSFDC_TEST80 30 7 RETURN;41 41 
28 10 ZSFDC_TEST80 30 8 SUB 300;42 42 
28 10 ZSFDC_TEST80 30 35 /* DELETE LOADED FROM LOAD TABLE */43 43 
28 10 ZSFDC_TEST80 30 25 GOTO 310 WHERE :NOLD = 1;44 44 
28 10 ZSFDC_TEST80 30 11 DELETE FROM45 45 
28 10 ZSFDC_TEST80 30 41 /********************** LOAD TABLE NAME*/46 46 
28 10 ZSFDC_TEST80 30 11 GENERALLOAD47 47 
28 10 ZSFDC_TEST80 30 41 /***************************************/48 48 
28 10 ZSFDC_TEST80 30 13 WHERE LINE IN49 49 
28 10 ZSFDC_TEST80 30 1 (50 50 
28 10 ZSFDC_TEST80 30 33 SELECT LINE FROM ZSFDC_CLEANTABLE51 51 
28 10 ZSFDC_TEST80 30 18 WHERE LOADID = :ID52 52 
28 10 ZSFDC_TEST80 30 12 AND LINE > 053 53 
28 10 ZSFDC_TEST80 30 2 );54 54 
28 10 ZSFDC_TEST80 30 10 LABEL 310;55 55 
28 10 ZSFDC_TEST80 30 7 RETURN;56 56 
EOF
echo End of Upgrade 7.0.4
